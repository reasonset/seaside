# コマンド

## 内部コマンド

```
command arg1 arg2...
```

commandはshellwordsとして解釈され、Seasideのコマンドが実行される。

## 外部コマンド

```
! command arg1 arg2
```

1st positionの値が `!` である場合、システムコマンドとして実行される。

これは内部的にはRubyの`fork`と`exec`によって実行される。
(つまり、Windowsでは動かないだろう)

## Rubyコマンド

```
*[ command arg1 arg2 ]*
```

1st positionの値が `!` である場合、`*[ ... ]*`で囲まれた範囲がRubyコマンドとして実行される。
これはRubyのevalによって評価されるものである。

なお、この解釈は

```re
^\*\[\s(.*?)\s\*\](?:$|\s)
```

であるので場合によっては注意が必要である。

# 変数

## 変数の型

Seasideの変数はネイティブな型として

* スカラー
* null
* 配列
* 連想配列

のいずれかになり、これ以外の型にはなり得ない。

ただし、内部的にはSeasideの変数はRubyオブジェクトである。
Seaside内ぶ非Seasideネイティブな型が展開された場合、オブジェクトは`to_s`メソッドが呼ばれ、文字列化される。

Seasideリテラルの型としてintがあるが、変数型としてはスカラーになり、これが数値として扱われるかどうかは(シェルのように)コマンドによる。

## リテラル代入

`name(type) = value` の形式で変数`name`にリテラル値を代入することができる。

`type`はリテラルの解釈の仕方を決定するためにあり、変数自体は動的である。

```
name(str) = Haruka
```

## 式代入

```
command -> name
```

コマンド列後方に `-> name` とすることで変数`name`にコマンドの結果を代入することができる。

コマンドが内部コマンド、Ruby展開の場合は戻り値、外部コマンドの場合は標準出力の内容が代入される。

## Rubyからの変数参照

埋め込まれたRubyからは変数は`$_ssparam[name]`の形で参照できる。

# パイプ

```
command1 | command2
```

任意の個数のコマンド列をパイプ (`|`) でつなぐことができる。

この場合、command1が内部コマンド、またはRubyコマンドならばその戻り値が渡される。
command2が外部コマンドならば、標準出力に書かれた内容が渡される。

受け取り方は、command2が内部コマンドならば、コマンドに引数がない場合は引数として使われ、引数がある場合は`${sspipe}`として参照できる。

command2がRubyコマンドならば、変数`$_sspipe`として参照することができる。

command2が外部コマンドの場合は標準入力から渡される。

全てのコマンド列が外部コマンドである場合のみ、これらは(シェルのように)PIPEでつながれた並列実行されるコマンド列として実行される。
そうでなければ、外部コマンドはまず全ての値を標準入力から読み込み、そして全ての値を標準出力に出力するデザインでなければならない。

# 埋め込みRuby

`{Ruby}>>>`という行から`<<<{Ruby`という行まではまるごとRubyに渡されevalされる。

```
{Ruby}>>>
<<<{Ruby}
```

`{Ruby}`に代えて`💎`を使ってもいい。

```
💎>>>
<<<💎
```

埋め込みRubyのコンテキストはSeasideスクリプト実行中永続的である。

ここからSeasideに変数を渡したい場合は次のようにすれば良い。

```
*[ var1 ]* -> seaside_var
```

または次のようにもできる。

```
$_ssparam["seaside_var"] = val
```

# コメント

`#`から行末まではコメントとして無視される。

# Seasideプログラムの例

```
name = ruka

date today -> date

! echo ${name} | tr a-z A-Z -> name
*[ "Ha" + $ssparam["name"] ]* -> name

print This is ${name}, hello, world in ${date}.  # This is HaRUKA, hello, world in 2020-09-18.
```
